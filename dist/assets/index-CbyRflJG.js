import{c as e,j as s,m as t,A as a}from"./animations-Bd-htQEL.js";import{a as n,r as i,R as r}from"./vendor-DENY9G7l.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)}).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();var l={},c=n;l.createRoot=c.createRoot,l.hydrateRoot=c.hydrateRoot;const o="/.netlify/functions",d=[{id:"guardian",name:"Guardian",emoji:"🛡️",color:"#3B82F6",message:"Guardian checking security and permissions..."},{id:"speedster",name:"Speedster",emoji:"⚡",color:"#F59E0B",message:"Speedster optimizing performance and assets..."},{id:"detective",name:"Detective",emoji:"🔍",color:"#10B981",message:"Detective running comprehensive tests..."},{id:"architect",name:"Architect",emoji:"🏗️",color:"#8B5CF6",message:"Architect finalizing deployment structure..."}];function m(){const[n,r]=i.useState(!1),[l,c]=i.useState("ready"),[m,u]=i.useState(null),[p,h]=i.useState(0),[g,y]=i.useState([]),[j,x]=i.useState(null),[f,N]=i.useState({}),[v,w]=i.useState("2.4.1"),[S,b]=i.useState(null),[k,$]=i.useState(null),[C,T]=i.useState(null),R=i.useRef(null),D=i.useRef(!1),L=i.useCallback(async()=>{if(S&&k&&!D.current){D.current=!0;try{const s=await fetch(`${o}/status?deploymentId=${S}&startTime=${encodeURIComponent(k)}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const t=await s.json();h(t.progress),N(t.agentStatuses),u(t.currentStage),w(t.version),T(null),t.messages&&t.messages.length>0&&y(e=>{const s=t.messages.filter(s=>!e.some(e=>e.text===s.text));return[...e,...s]}),t.isComplete&&(r(!1),c("success"),x({time:(new Date).toLocaleString(),status:"Success",version:t.version}),R.current&&(clearInterval(R.current),R.current=null),e({particleCount:100,spread:70,origin:{y:.6}}))}catch(s){console.error("Polling error:",s),T("Unable to check deployment status. Please refresh the page.")}finally{D.current=!1}}},[S,k]);i.useEffect(()=>{if(n&&S&&k)return L(),R.current=setInterval(L,2e3),()=>{R.current&&(clearInterval(R.current),R.current=null)}},[n,S,k,L]),i.useEffect(()=>{(async()=>{try{const e=await fetch(`${o}/deploy`,{method:"GET",headers:{"Content-Type":"application/json"}});if(e.ok){const s=await e.json();w(s.version),c(s.status)}}catch(e){console.error("Failed to load initial status:",e)}})()},[]);return s.jsxs("div",{className:"app",children:[s.jsxs("header",{className:"header",children:[s.jsx("h1",{children:"📅 FOGG Calendar Update Center"}),s.jsx("p",{className:"subtitle",children:"Hi Leslie! Ready to update the calendar?"})]}),s.jsxs("main",{className:"main-content",children:[s.jsxs("div",{className:"status-card",children:[s.jsx("h2",{children:"System Status"}),s.jsxs("div",{className:"status-grid",children:[s.jsxs("div",{className:"status-item",children:[s.jsx("span",{className:"status-label",children:"Calendar Version:"}),s.jsx("span",{className:"status-value",children:v})]}),s.jsxs("div",{className:"status-item",children:[s.jsx("span",{className:"status-label",children:"Last Update:"}),s.jsx("span",{className:"status-value",children:j?`${j.time} (v${j.version||"Unknown"})`:"Never"})]}),s.jsxs("div",{className:"status-item",children:[s.jsx("span",{className:"status-label",children:"Status:"}),s.jsxs("span",{className:`status-badge ${l}`,children:["ready"===l&&"✅ Ready","deploying"===l&&"⏳ Updating...","success"===l&&"🎉 Updated!","failed"===l&&"⚠️ Need Help"]})]})]})]}),s.jsxs("div",{className:"deploy-section",children:[s.jsx(t.button,{className:"deploy-button "+(n?"deploying":""),onClick:async()=>{if(!n)try{T(null),r(!0),c("deploying"),h(0),y([{text:"Starting calendar update... Our friendly helpers are on it!",timestamp:(new Date).toLocaleTimeString(),type:"info"}]),N({}),u(null);const e=await fetch(`${o}/deploy`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({environment:"production",user:"Leslie"})});if(!e.ok)throw new Error(`Deployment failed: ${e.status}`);const s=await e.json();if(!s.success)throw new Error(s.message||"Deployment failed");b(s.deploymentId),$(s.startTime),y(e=>[...e,{text:`Deployment ${s.deploymentId} started successfully!`,timestamp:(new Date).toLocaleTimeString(),type:"info"}])}catch(e){console.error("Deployment error:",e),T(e.message),r(!1),c("failed"),y(s=>[...s,{text:`Deployment failed: ${e.message}`,timestamp:(new Date).toLocaleTimeString(),type:"error"}])}},disabled:n,whileHover:{scale:n?1:1.05},whileTap:{scale:n?1:.95},children:n?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"spinner",children:"⏳"}),"Updating Calendar..."]}):s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"button-icon",children:"🚀"}),"Update Calendar Now"]})}),n&&s.jsx("p",{className:"deploy-hint",children:"This usually takes about 5 minutes. You can watch the progress below!"})]}),C&&s.jsxs("div",{className:"error-section",children:[s.jsxs("div",{className:"error-message",children:["⚠️ ",C]}),s.jsx("button",{className:"retry-button",onClick:()=>{T(null),r(!1),c("ready")},children:"Try Again"})]}),n&&s.jsxs("div",{className:"progress-section",children:[s.jsx("div",{className:"progress-bar-container",children:s.jsx(t.div,{className:"progress-bar",initial:{width:0},animate:{width:`${p}%`},transition:{duration:.5}})}),s.jsxs("p",{className:"progress-text",children:[p,"% Complete",m&&s.jsxs("span",{className:"current-agent",children:[m.emoji," ",m.message]})]})]}),s.jsxs("div",{className:"agents-section",children:[s.jsx("h2",{children:"Your Helpful Assistants"}),s.jsx("div",{className:"agents-grid",children:d.map(e=>s.jsxs(t.div,{className:`agent-card ${f[e.id]||"waiting"}`,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[s.jsx("div",{className:"agent-emoji",children:e.emoji}),s.jsx("h3",{children:e.name}),s.jsxs("p",{className:"agent-message",children:["working"===f[e.id]&&e.message,"done"===f[e.id]&&"✅ All done!","waiting"===f[e.id]&&"Ready to help!",!f[e.id]&&"Waiting..."]}),"working"===f[e.id]&&s.jsxs("div",{className:"agent-working",children:[s.jsx("span",{className:"pulse-dot"}),"Working..."]})]},e.id))})]}),g.length>0&&s.jsxs("div",{className:"messages-section",children:[s.jsx("h2",{children:"What's Happening"}),s.jsx("div",{className:"messages-container",children:s.jsx(a,{children:g.slice(-5).map((e,a)=>s.jsxs(t.div,{className:`message message-${e.type}`,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:[s.jsx("span",{className:"message-time",children:e.timestamp}),s.jsx("span",{className:"message-text",children:e.text})]},`${e.timestamp}-${a}`))})})]}),s.jsxs("div",{className:"help-section",children:[s.jsx("h3",{children:"Need Help?"}),s.jsx("p",{children:"If anything looks wrong or you're not sure, just text Patrick! He'll help you right away. Remember: you can't break anything - the system keeps everything safe automatically."})]})]})]})}l.createRoot(document.getElementById("root")).render(s.jsx(r.StrictMode,{children:s.jsx(m,{})}));
